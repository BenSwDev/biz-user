
# 1. הקדמה
בקובץ היחיד שנמצא ונסרק במלואו (`cms/classes/class.ServerTest.php`), מוגדרת מחלקה בשם `ServerTest` האחראית לבצע בדיקה של קובץ טקסט מקומי ושל הגרסה שלו גם בשרת מרוחק, על מנת לוודא שהשרת מתפקד כראוי. הקובץ עושה זאת באמצעות:
1. קריאה מקומית של קובץ (`server_test_file_for_cron_scripts.txt`) ובדיקה שהוא מתחיל בטקסט `"SID-"`.
2. שליפת אותו קובץ מהדומיין המרוחק (`https://bizonline.co.il/server_test_file_for_cron_scripts.txt`), בדיקה שהוא מתחיל גם הוא ב־`"SID-"` ובדיקה שקוד התשובה מהשרת הוא 200.
3. השוואת התוכן שהתקבל מהקובץ המקומי לזה שהתקבל מהקובץ המרוחק.
4. שליחת התראה (באמצעות `mail()`) אם מתגלות חריגות כלשהן (התוכן לא קיים, לא מתחיל ב־`"SID-"`, או שאינו תואם).

# 2. הקבצים שנבדקו
1. **`cms/classes/class.ServerTest.php`**  
   - בקובץ זה קיימת המחלקה `ServerTest`.
   - המחלקה כוללת משתנים סטטיים:  
     - `$file_domain` - מצביע על הכתובת הדומיין המרוחק.
     - `$file_path` - מצביע על הנתיב המקומי שבו מחפשים את הקובץ.
     - `$file_name` - שם הקובץ (כברירת מחדל: `server_test_file_for_cron_scripts.txt`).
     - `$alert_to`, `$alert_from` - כתובות דוא״ל להתראות קריטיות.
   - המתודה `isActive()` בודקת האם הקובץ המקומי והקובץ המרוחק קיימים, תקינים, ושווי תוכן.
   - המתודה `alert($text)` שולחת התראה בדוא״ל אם מתגלה בעיה בבדיקה.

# 3. הקבצים שלא נמצאו
(אין קבצים נוספים שצוינו במפורש ככאלה שלא נמצאו.)

# 4. הקבצים שלא נבדקו
1. **`server_test_file_for_cron_scripts.txt`**  
   הקובץ מוזכר בקוד ומוגדר כקובץ טקסט שיש לאמת את קיומו ותוכנו, אך הוא אינו מופיע ברשימת הקבצים שנמסרה (לא ברור אם הוא קיים במציאות, אך מכל מקום הוא לא נסרק בפועל).

# 5. תרחישים כוללים בעמוד

## הוראות לניתוח קוד ובניית תרחישי שימוש (Use Flow Scenarios)

### 5.1. זיהוי כל תרחישי השימוש
הקוד שבקובץ `class.ServerTest.php` מממש בפועל **תרחיש שימוש עיקרי אחד**:

**תרחיש שימוש עיקרי**: בדיקת תקינות השרת  
- בדיקה שהקובץ המקומי קיים ותקין (מכיל מחרוזת שמתחילה ב־`"SID-"`).
- בדיקה שהקובץ המרוחק קיים ותקין (גם הוא מתחיל ב־`"SID-"` והתקבלה תשובת HTTP 200).
- השוואת תכני שני הקבצים.
- במידה והבדיקה נכשלת באחד השלבים – שולחים התראה באימייל.

### 5.2. מבנה הניתוח של תרחיש השימוש

#### 1. תיאור משתמש הקצה (Front-End / User Perspective)
זהו תרחיש המבוצע, לרוב, מאחורי הקלעים (במסגרת Cron Job או סקריפט שרץ בצד השרת). מנקודת מבט "משתמשתית", ניתן לתאר אותו כך:

- **תיאור כללי**  
  המשתמש (או מנהל השרת) מצפה שהמערכת תבדוק באופן אוטומטי שהקובץ הדרוש עדיין קיים גם בשרת המקומי וגם בשרת המרוחק, ושהתוכן תואם. אם קיים כשל, המשתמש מקבל התראה במייל אודות הבעיה.

- **טבלת צעדי התרחיש מצד המשתמש**  

| מספר צעד | פעולה מצד המשתמש        | תוצאה מצופה                                                               |
|----------|-------------------------|---------------------------------------------------------------------------|
| 1        | הפעלת הסקריפט/הקרון    | נשלחת פקודה לבדיקה אוטומטית של קובץ מקומי ושל קובץ מרוחק.                |
| 2        | (אין פעולה ישירה)      | במידה ויש כשל בבדיקה, המשתמש יקבל התראה במייל אודות הבעיה שזוהתה.         |
| 3        | (אין פעולה ישירה)      | אם הבדיקה עוברת בהצלחה, לא נשלחת התראה, והכל ממשיך כרגיל.                |

> **הערה:** מבחינת משתמש הקצה, אין ממשק חזותי (UI) – זהו תהליך שנעשה כולו בצד השרת.

#### 2. תיאור המימוש בקוד (Back-End / Developer Perspective)
- **תיאור כללי**  
  המחלקה `ServerTest` מכילה מתודה עיקרית בשם `isActive()` שמממשת את השלבים הבאים:
  1. קריאה לתוכן קובץ מקומי ובדיקה שהוא קיים ותקין.
  2. חיבור לכתובת מרוחקת באמצעות `cURL` וקריאת תוכן הקובץ מהשרת.
  3. בדיקת קוד התשובה (200) ותוכן הקובץ שצריך להתחיל ב־`"SID-"`.
  4. השוואת התוכן המקומי והמרוחק.
  5. שליחת אימייל התראה אם קיים כשל.

- **טבלת צעדי התרחיש מצד המתכנת**  

| מספר צעד | לוגיקה טכנית                                                                                                              | מיקום בקוד                                            | מבנה ותוכן הקוד                                                                                                                                       |
|----------|----------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1        | שליפת תוכן הקובץ המקומי באמצעות `file_get_contents()`.                                                                     | `isActive()` בשורות הפתיחה                            | ```php<br>$local = file_get_contents(static::$file_path . static::$file_name);<br>if (!$local \|\| substr($local, 0, 4) != 'SID-'){ ... }<br>```       |
| 2        | פתיחת חיבור `cURL` לנתיב המרוחק: `static::$file_domain . static::$file_name`.                                             | `isActive()` באמצע המתודה                             | ```php<br>$curl = curl_init(static::$file_domain . static::$file_name);<br>...<br>$remote = curl_exec($curl);<br>$stats = curl_getinfo($curl);<br>``` |
| 3        | בדיקה שהתוכן המרוחק תקין: מתחיל ב־`"SID-"` וקוד התשובה `($stats['http_code'] == 200)`.                                    | `isActive()`                                          | ```php<br>if (!$remote \|\| substr($remote, 0, 4) != 'SID-' \|\| $stats['http_code'] != 200){ ... }<br>```                                             |
| 4        | השוואת התוכן המקומי והמרוחק: `return !strcmp($local, $remote);`                                                            | סוף `isActive()`                                      | ```php<br>return !strcmp($local, $remote);<br>```                                                                                                      |
| 5        | המתודה `alert($text)` שולחת דוא״ל לכתובת המוגדרת ב־`static::$alert_to`, עם נושא `"Critical error in server detection script"`. | `alert()`                                             | ```php<br>mail(static::$alert_to, 'Critical error...', $text, "From: ".static::$alert_from);<br>```                                                                                  |

# 6. מסמך שימוש (מדריך למשתמש)
המערכת פועלת בעיקר מאחורי הקלעים, אבל אם בכל זאת תרצה לוודא שהיא מבצעת את עבודתה:

1. **הגדרת הקובץ המקומי**  
   - ודא שקיים הקובץ `server_test_file_for_cron_scripts.txt` בנתיב המוגדר במשתנים `$file_path` ו־`$file_name`.
   - ודא שתוכנו מתחיל בפורמט `"SID-"` (לדוגמה: `SID-12345`).

2. **הגדרת כתובת הדומיין המרוחק**  
   - בקובץ `class.ServerTest.php`, ודא שהמשתנה `$file_domain` אכן מצביע על הכתובת הנכונה.
   - ודא שהקובץ המרוחק זמין ושהתוכן בו תואם לתוכן הקובץ המקומי.

3. **הפעלת הסקריפט או הגדרת Cron**  
   - ניתן להריץ את המתודה `ServerTest::isActive()` ידנית (למשל בפעולה קצרה של PHP) או לקבוע Cron Job שמפעיל אותה.
   - במקרה של כשל, תקבל הודעת אימייל אוטומטית מכתובת `static::$alert_from` אל כתובת `static::$alert_to`.

4. **קבלת התראות**  
   - אם הכל תקין, אין תקשורת חיצונית למשתמש.  
   - אם יש בעיה (קובץ מקומי חסר, קובץ מרוחק חסר/לא תקין, או תכנים לא תואמים) תישלח התראה למייל שהוגדר.

5. **טיפול בתקלות**  
   - במידה ומתקבלת התראה, בדוק את הטקסט שהתקבל, את פרטי השרת המודפסים בסוף, ודא שקובצי הטקסט מקומיים ומרוחקים עדכניים ותואמים.

# 7. סיכום
המסמך מציג את הקובץ היחיד שנסרק (`class.ServerTest.php`) ואת הפונקציונליות שלו בבדיקת תקינות קובץ מקומי מול קובץ מרוחק. התהליך מסייע באיתור תקלות שרת פוטנציאליות ומשמש כמנגנון התראה במידת הצורך. אין קבצים נוספים שנסקרו, אך יש אזכור לקובץ טקסט (`server_test_file_for_cron_scripts.txt`) שאינו נכלל ברשימה בפועל ולא נבדק.

---
```

---

## 2. הרשימה להעתקה של הקבצים (שורה אחר שורה)

להלן שלוש הרשימות (לפי ההנחיות, בכל רשימה רק שם הקובץ, שורה אחר שורה):

**1) קבצים שנבדקו**  
```
cms/classes/class.ServerTest.php
```

**2) קבצים שלא נמצאו**  
*(אין קבצים ברשימה זו)*

**3) קבצים שלא נבדקו**  
```
server_test_file_for_cron_scripts.txt
```
