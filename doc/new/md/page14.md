# מסמך ניתוח מלא

## 1. הקדמה
המערכת המוצגת כאן מורכבת ממספר קבצים שמטפלים בפעולות הקשורות לניהול לקוחות, יצירת ממשק משתמש להצגת נתוני לקוחות, סינון וחיפוש, שליחת SMS, וייצוא הנתונים לאקסל. כל הקבצים הנכללים בניתוח נסרקו במלואם, והם מספקים תמונה רחבה של הטיפול בנתוני לקוח מצד ה-Front-End (כמו טפסי חיפוש והצגת טבלה) ומצד ה-Back-End (כמו פעולות AJAX למחיקה, חיפוש ושמירת נתונים).

המערכת עובדת תוך התייחסות להרשאות המשתמש לאתרים (siteID), ומאפשרת לבצע שאילתות מבוססות מגוון פרמטרים (תאריכים, סוג, מקור, חיפוש חופשי, ועוד). בין השאר, ניתן לאתר לקוחות, לעדכן ולמחוק רשומות, לשלוח הודעות SMS ישירות מהממשק, ולייצא לאקסל. להלן ניתוח הקוד והתרחישים המרכזיים המופיעים בו.

---

## 2. הקבצים שנבדקו
1. **pages/clients.php**
    - קובץ זה מציג טופס חיפוש וסינון של לקוחות, ויוצר טבלת תוצאות המציגה נתונים כמו שם, טלפון, דוא"ל, כתובת, תאריך הוספה, תאריך עדכון, ועוד.
    - מבצע בדיקת הרשאות ל-siteID, בונה שאילתת SELECT על `crm_clients` לפי פרמטרים מה-GET (כגון `from`, `to`, `source`, `ads`, ועוד).
    - כולל גם כפתור למחיקת לקוח (דרך AJAX), אפשרות שליחת SMS (נפתחת חלונית פופ-אפ), וכפתור לייצוא לאקסל.

2. **ajax_client.php**
    - קובץ AJAX המטפל בשתי פעולות עיקריות (`act`):
        1. `clientInfo` – חיפוש אוטומטי (auto-complete) לפי פרטי לקוח (טלפון, שם, אימייל, ת"ז), עם בדיקת הרשאות.
        2. `delete` – מחיקת רשומת לקוח ממסד הנתונים, גם כאן עם בדיקת הרשאות (לפי siteID והאם המשתמש מורשה).

3. **partials/orders_menu.php**
    - קובץ המכיל תפריט עליון (subMenu) עבור עמודי “הזמנות” (orders).
    - ברשימת התפריט מוגדרים קישורים המובילים לטיפול בהזמנות: פעילים, שיריונים, הזמנות שדורשות חתימה, ועוד.
    - איננו בשימוש ישיר בעמוד `clients.php` (מופיע כ־include שמוחרז, אך כרגע בהערה), אך הקובץ קיים ונסרק בפועל.

4. **ajax_spaSMS.php**
    - קובץ AJAX לשיגור הודעות SMS.
    - מקבל נתונים כמו `phone`, `sms_con`, `siteID` או `orderID`, ושולח SMS באמצעות `Maskyoo::sms(...)`.
    - במידה שיש `orderID`, נשלחת ההודעה לפי הלקוח המסוים; אם לא, מסתמכים על הטלפון שהתקבל בפרמטר.
    - בסיום מנסה לרשום את השליחה לטבלאות `orders_sms` או `sms_manual`, לפי ההקשר.

5. **ajax_excel_clients.php**
    - קובץ AJAX היוצר קובץ להורדה בפורמט CSV (נקרא “clients.csv”) ומגיש אותו כדאטה להורדה.
    - מפעיל לוגיקה דומה לזו שב-`pages/clients.php` לצורך סינון הלקוחות (`$where`), אך במקום להציג אותם בדפדפן, משתמש בפעולה `fputcsv` לכתיבת התוצאות לקובץ CSV.
    - מוסיף כותרת עמודות מתאימה (ID, שם מלא, ת.ז., טלפון, דוא"ל, כתובת, דיוור, תאריך הוספה, עדכון אחרון), ושולח את הקובץ להורדה.

---

## 3. הקבצים שלא נמצאו
לא קיימים קבצים שלגביהם צוין במפורש “הקובץ לא נמצא”. על כן, רשימה זו ריקה.

---

## 4. הקבצים שלא נבדקו
לא אותרו קבצים שנדרשים לפי ההיגיון או ההתייחסות שבתוכן הקבצים ושהם אינם מופיעים כלל ברשימת הקבצים.  
כל הקבצים שהוזכרו ושאינם בהחרגה המפורשת (כגון `auth.php`, `functions.php` וכו') – סופקו ונסרקו בפועל.  
על כן, גם רשימה זו ריקה.

---

## 5. תרחישים כוללים בעמוד
להלן ניתוח מקיף של תרחישי שימוש (Use Flow Scenarios) המבוססים על הקוד:

### **1. זיהוי כל תרחישי השימוש (Use Flow)**
1. **צפייה ברשימת לקוחות** – טעינה ראשונית של `pages/clients.php` והצגת טבלת לקוחות כברירת מחדל.
2. **חיפוש וסינון לקוחות** – שימוש בטופס סינון, פרמטרים ותאריכים.
3. **Auto-Complete של פרטי לקוח** – השלמה אוטומטית בשדה טלפון/שם/אימייל.
4. **שליחת SMS ללקוח** – פתיחת פופ-אפ ושליחה דרך `ajax_spaSMS.php`.
5. **מחיקת לקוח** – לחיצה על אייקון “X” ושימוש ב-`ajax_client.php?act=delete`.
6. **ייצוא לאקסל** – לחיצה על כפתור “ייצוא לאקסל” ושימוש ב-`ajax_excel_clients.php`.
7. **תפריט “הזמנות”** (קובץ `partials/orders_menu.php`) – קישור לעמודים הקשורים ל-“orders” (לא ישירות בעמוד הלקוחות, אך זמין ככולל).

---

### **2. מבנה הניתוח של כל תרחיש שימוש**
לכל תרחיש יוצגו שני חלקים:
1. **תיאור משתמש הקצה (Front-End Perspective)**
2. **תיאור המימוש בקוד (Back-End Perspective)**

---

#### תרחיש 1: צפייה ברשימת לקוחות
**א. ניתוח משתמש הקצה (Front-End Perspective)**
- **תיאור כללי:**  
  המשתמש נכנס לעמוד “clients” (למשל `?page=clients`) מבלי להגדיר פרמטרי חיפוש ייעודיים. הוא מצפה לראות רשימת לקוחות כללית.

| מספר צעד | פעולה מצד המשתמש               | תוצאה מצופה                                                                      |
|----------|--------------------------------|----------------------------------------------------------------------------------|
| 1        | כניסה לכתובת `?page=clients`  | הדף נטען ומציג טבלת לקוחות מלאה (בלי סינון מיוחד), כמות לקוחות, ושורת חיפוש מוסתרת. |
| 2        | גלילה והתבוננות בטבלה         | המשתמש רואה את כל הנתונים הקיימים עבור כל לקוח (שם, טלפון, מייל, תאריך הוספה וכו'). |

**ב. ניתוח המימוש בקוד (Back-End Perspective)**
- **תיאור כללי:**  
  הקוד ב-`pages/clients.php` בודק אם הוגדרו פרמטרים ב-$_GET. אם לא – נטענות כברירת מחדל הגדרות (תאריך “2001-01-01” ועד היום, ללא סינון חיצוני).  
  לאחר מכן מתבצעת שאילתה (SELECT) לטבלת `crm_clients`, והתוצאות מוצגות.

| מס' צעד | לוגיקה טכנית                                                                                  | מיקום בקוד             | מבנה ותוכן הקוד                                                                                       |
|---------|-----------------------------------------------------------------------------------------------|------------------------|--------------------------------------------------------------------------------------------------------|
| 1       | בדיקת `sid` והרשאות המשתמש (`$_CURRENT_USER->has($sid)`).                                    | `pages/clients.php`    | `if($sid && !$_CURRENT_USER->has($sid)){ echo 'Access denied'; return; }`                              |
| 2       | הגדרת משתנה `$timeFrom` ל-`2001-01-01` והגדרת `$timeUntil` לתאריך של סוף חודש נוכחי (ברירת מחדל). | `pages/clients.php`    | `$timeFrom = '2001-01-01';` / `$timeUntil = date("Y-m-t");`                                           |
| 3       | בניית תנאי `$where` על סמך siteID ופרמטרים נוספים (אם נשלחו; אם לא – לוקחים ברירות מחדל).     | `pages/clients.php`    | `$where = ["c.siteID IN (...)"];`                                                                     |
| 4       | איסוף התוצאות עם `udb::key_row("SELECT ... FROM crm_clients ...")`                           | `pages/clients.php`    | `$clients = udb::key_row("SELECT ...", 'clientID');`                                                  |
| 5       | הצגת הטבלה ב-HTML, לולאה על `$clients`.                                                      | `pages/clients.php`    | `<tr> data-cid=... data-sid=...`                                                                      |

---

#### תרחיש 2: חיפוש וסינון לקוחות
**א. ניתוח משתמש הקצה (Front-End Perspective)**
- **תיאור כללי:**  
  המשתמש לוחץ על כותרת "חפש לקוח" לפתיחת הטופס, מזין תאריכים ומקור (או שדות אחרים), ולוחץ “חפש”. מתקבלת רשימת לקוחות מסוננת.

| מספר צעד | פעולה מצד המשתמש                                          | תוצאה מצופה                                                                                |
|----------|-----------------------------------------------------------|--------------------------------------------------------------------------------------------|
| 1        | לחיצה על "חפש לקוח"                                      | הטופס נפתח, מציג שדות למילוי (from/to, source, ads וכו').                                  |
| 2        | מילוי אחד או יותר מהשדות (תאריך, מקור, טלפון, freeText)   | המשתמש בוחר פרמטרים רלוונטיים.                                                            |
| 3        | לחיצה על כפתור “חפש”                                     | הדף נשלח מחדש עם הפרמטרים, והטבלה מציגה רק את הלקוחות העונים לסינון שנקבע.                 |

**ב. ניתוח המימוש בקוד (Back-End Perspective)**
- **תיאור כללי:**  
  ב-`pages/clients.php`, לאחר שלוחצים “submit” בטופס (method=GET), הקוד משתמש בערכי `$_GET['from']`, `$_GET['to']`, `$_GET['source']` וכו' לצורך הרכבת תנאי ה-WHERE.

| מס' צעד | לוגיקה טכנית                                                                 | מיקום בקוד          | מבנה ותוכן הקוד                                                                                                                                                                                 |
|---------|------------------------------------------------------------------------------|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1       | קריאת פרמטרים (`$_GET['from']`, `$_GET['to']`, `$_GET['source']`, …).        | `pages/clients.php` | `if($_GET['from']) { $timeFrom = typemap(...); } else { ... }` וכן הלאה.                                                                                                                          |
| 2       | בניית `$where[]` בהתאם לערכים שהוזנו (source=..., allowAds=..., freeText...).| `pages/clients.php` | `if($_GET['ads'] > 0) $where[] = "c.allowAds = 1"; ... if($freeText) $where[] = "(" . implode(...) . ")";`                                                                                      |
| 3       | הרצת השאילתה עם התנאים וסדר המיון (כגון `$_GET['sfld']`).                    | `pages/clients.php` | `$clients = udb::key_row("SELECT ... WHERE " . implode(" AND ", $where) . " ORDER BY ...");`                                                                                                     |
| 4       | הצגת התוצאות המסוננות בטבלה.                                                 | `pages/clients.php` | בלולאה `<tr>` עבור כל לקוח.                                                                                                                                                                      |

---

#### תרחיש 3: Auto-Complete של פרטי לקוח
**א. ניתוח משתמש הקצה (Front-End Perspective)**
- **תיאור כללי:**  
  בעת הקלדה של לפחות 3 תווים בשדה טלפון/שם, מוצגות הצעות להשלמה אוטומטית של לקוחות.

| מספר צעד | פעולה מצד המשתמש                    | תוצאה מצופה                                                          |
|----------|-------------------------------------|----------------------------------------------------------------------|
| 1        | הקלדה בשדה טקסט (מינימום 3 תווים)   | מוצגת רשימת הצעות (שמות וטלפונים תואמים).                            |
| 2        | בחירה בפריט מהרשימה                 | השדות הנדרשים (כגון טלפון, שם) מתמלאים באופן אוטומטי.                |

**ב. ניתוח המימוש בקוד (Back-End Perspective)**
- **תיאור כללי:**  
  בסקריפט JS המובנה ב-`pages/clients.php`, יש קריאה דינמית ל-`ajax_client.php?act=clientInfo&sid=...&val=...`.  
  ב-`ajax_client.php` נבדקת ההרשאה ואת אורך המחרוזת (`>=3`).

| מס' צעד | לוגיקה טכנית                                                                             | מיקום בקוד              | מבנה ותוכן הקוד                                                                                                        |
|---------|------------------------------------------------------------------------------------------|-------------------------|-------------------------------------------------------------------------------------------------------------------------|
| 1       | קריאת AJAX ל-`ajax_client.php?act=clientInfo&sid=...&val=...`.                          | `pages/clients.php` JS  | `$.get('ajax_client.php', {act:'clientInfo', sid:..., val:str}).then(res => res.clients);`                              |
| 2       | ב-`ajax_client.php`, בכניסה ל-`case 'clientInfo':`                                      | `ajax_client.php`       | בדיקה: `if (!$input['sid'] || !$_CURRENT_USER->has($input['sid'])) throw new Exception("Access denied...");`           |
| 3       | בדיקה ש`mb_strlen($val) >= 3`; אם לא – Exception.                                        | `ajax_client.php`       | `if (mb_strlen($input['val'], 'UTF-8') < 3) throw new Exception("Search string too short");`                            |
| 4       | הרצת SELECT עם תנאי LIKE על מספר שדות (`clientMobile`, `clientName`, `clientEmail` וכו'). | `ajax_client.php`       | `$result['clients'] = udb::single_list($que);`                                                                          |
| 5       | החזרת התוצאות ב-JSON ל-Front-End, והצגתן ברשימת ההשלמה האוטומטית.                       | `ajax_client.php`       | `echo json_encode($result);`                                                                                            |

---

#### תרחיש 4: שליחת SMS ללקוח
**א. ניתוח משתמש הקצה (Front-End Perspective)**
- **תיאור כללי:**  
  משתמש לוחץ על “שליחת SMS” בעמוד `clients.php`, נפתחת פופ-אפ להזנת מספר טלפון והודעה, וקיימת אפשרות להשלמה אוטומטית. בלחיצה על כפתור “שליחה” – ההודעה נשלחת.

| מספר צעד | פעולה מצד המשתמש                                 | תוצאה מצופה                                                                                    |
|----------|--------------------------------------------------|------------------------------------------------------------------------------------------------|
| 1        | לחיצה על הכפתור “שליחת SMS”                      | מופיע פופ-אפ ובו שדות להזנת טלפון והודעת טקסט.                                                  |
| 2        | הזנת הטלפון ו/או שימוש ב-Auto-Complete (אם רצוי).| השדה מתמלא בנתוני הלקוח, כמו שם/טלפון.                                                          |
| 3        | הזנת תוכן ה-SMS (מוגבל ל-80 תווים).              | תצוגת מונה מתעדכנת, המשתמש רואה כמה תווים נותרו.                                               |
| 4        | לחיצה על “שליחה”                                 | שולח בקשת AJAX ל-`ajax_spaSMS.php`, ומחזיר תגובת הצלחה/שגיאה. אם הצליח – החלונית נסגרת.         |

**ב. ניתוח המימוש בקוד (Back-End Perspective)**
- **תיאור כללי:**  
  ב-JavaScript שב-`pages/clients.php`, עם הלחיצה על כפתור `.send`, נשלחת בקשה `$.post('ajax_spaSMS.php', {...})`.  
  ב-`ajax_spaSMS.php` נקרא `Maskyoo::sms(...)` לשיגור ההודעה, ואם הצליח – נרשם לוג לטבלה `orders_sms` או `sms_manual`.

| מס' צעד | לוגיקה טכנית                                                                                 | מיקום בקוד           | מבנה ותוכן הקוד                                                                                                  |
|---------|----------------------------------------------------------------------------------------------|----------------------|-------------------------------------------------------------------------------------------------------------------|
| 1       | זיהוי קליק על אלמנט `.sms-pop .send`.                                                       | `pages/clients.php`  | `$('.sms-pop .send').on('click', function() { ... });`                                                           |
| 2       | איסוף הטלפון (`phone`) ותוכן ההודעה (`smscon`).                                             | `pages/clients.php`  | `let _phone = $('input[name="phone"]').val(); let _con = $('textarea[name="smscon"]').val();`                    |
| 3       | קריאת `$.post('ajax_spaSMS.php', {phone:..., sms_con:..., siteID:...})`.                    | `pages/clients.php`  | נשלחים הפרמטרים למימוש ב-PHP, יחד עם `$_CURRENT_USER->active_site()`.                                            |
| 4       | ב-`ajax_spaSMS.php`:  
- בדיקת הרצה (`require_once "auth.php"`).
- אם קיים `phone` (ואין `orderID`), שולחים SMS עם `Maskyoo::sms()`.
- רושמים טבלה `sms_manual`/`orders_sms` לפי העניין.                                                       | `ajax_spaSMS.php`    | `if($orderID)... else { ... } $send = Maskyoo::sms($text, $phone, $smsName);`  לאחר מכן `INSERT INTO sms_manual...` |
  | 5       | החזרת תשובה (JSON) עם `res.msg` במקרה הצלחה או `res.error` במקרה כישלון.                       | `ajax_spaSMS.php`    | `echo json_encode($result, ...);`                                                                                 |
  | 6       | הצגת ההודעה למשתמש (`Swal.fire(...)`), וסגירת החלונית בהצלחה.                                | `pages/clients.php`  | `if(res.error) ... else Swal.fire({icon:'success', ...}).then(...);`                                              |

---

#### תרחיש 5: מחיקת לקוח
**א. ניתוח משתמש הקצה (Front-End Perspective)**
- **תיאור כללי:**  
  בטבלת הלקוחות, בכל שורה מופיע אייקון “X” למחיקה. לחיצה עליו מפעילה תיבת אישור, ולאחר אישור – הלקוח נמחק.

| מספר צעד | פעולה מצד המשתמש                          | תוצאה מצופה                                        |
|----------|-------------------------------------------|----------------------------------------------------|
| 1        | לחיצה על אייקון “X” בשורת הלקוח           | תיבה (Swal) שואלת “בטוח למחוק?”                   |
| 2        | אישור (OK) או ביטול (Cancel)             | אישור – מוחק הלקוח; ביטול – מבטל את הפעולה.        |
| 3        | אם אושר, הלקוח מוסר מיד מהטבלה בדפדפן.    | המחיקה מתבצעת בשרת דרך `ajax_client.php?act=delete`. |

**ב. ניתוח המימוש בקוד (Back-End Perspective)**
- **תיאור כללי:**  
  הקוד ב-`pages/clients.php` (JavaScript) שולח `$.post('ajax_client.php', {act:'delete', cid:..., sid:...})`.  
  ב-`ajax_client.php` ממומש `case 'delete':` – מוחקים את השורה מ-`crm_clients`.

| מס' צעד | לוגיקה טכנית                                                             | מיקום בקוד          | מבנה ותוכן הקוד                                                                                               |
|---------|------------------------------------------------------------------------|---------------------|----------------------------------------------------------------------------------------------------------------|
| 1       | איתור ה-clientID וה-siteID מה-`<tr>` (`data-cid`, `data-sid`).         | `pages/clients.php` | `let data = $(this).closest('tr').data();`                                                                    |
| 2       | swal.fire(...) להצגת תיבת אישור.                                       | `pages/clients.php` | `Swal.fire({title:'בטוח?', ...}).then((result) => { if(result.isConfirmed) ... });`                            |
| 3       | שליחת `$.post('ajax_client.php', {act:'delete', cid:data.cid, sid:data.sid})`. | `pages/clients.php` | `$.post('ajax_client.php', {act:'delete', ...}).then(() => $(this).closest('tr').remove());`                  |
| 4       | ב-`ajax_client.php`, ב-case `'delete'`: בדיקת הרשאה ו-`clientID`.      | `ajax_client.php`   | `if(!$siteID || !$_CURRENT_USER->has($siteID)) throw new Exception("Access denied...");`                       |
| 5       | `udb::query("DELETE FROM crm_clients WHERE siteID=... AND clientID=...");`.   | `ajax_client.php`   | מוחק רשומה בהתאם ל-ID באתר.                                                                                   |
| 6       | מחזיר JSON למשתמש (status=0 / הודעת שגיאה).                            | `ajax_client.php`   | `echo json_encode($result);`                                                                                   |

---

#### תרחיש 6: ייצוא לאקסל
**א. ניתוח משתמש הקצה (Front-End Perspective)**
- **תיאור כללי:**  
  המשתמש לוחץ על כפתור “ייצוא לאקסל” בעמוד `clients.php`. הדפדפן מוריד קובץ CSV (עם סיומת .csv) המכיל את רשימת הלקוחות המסוננת.

| מספר צעד | פעולה מצד המשתמש                | תוצאה מצופה                                         |
|----------|--------------------------------|-----------------------------------------------------|
| 1        | לחיצה על כפתור “ייצוא לאקסל”    | מופעלת פקודה המפנה ל-`ajax_excel_clients.php?...`.  |
| 2        | הורדת הקובץ למחשב המקומי        | המשתמש יקבל קובץ CSV, אותו יוכל לפתוח בתוכנת Excel. |

**ב. ניתוח המימוש בקוד (Back-End Perspective)**
- **תיאור כללי:**  
  ב-`pages/clients.php` קיים אלמנט בעל id `expExcel`, המפעיל `window.location.href = 'ajax_excel_clients.php' + window.location.search;`.  
  ב-`ajax_excel_clients.php` מתבצעת לוגיקה דומה של סינון (`$where[]`), ולאחר מכן כתיבת קובץ CSV לזרם הפלט (`php://output`).

| מס' צעד | לוגיקה טכנית                                                                                  | מיקום בקוד               | מבנה ותוכן הקוד                                                                         |
|---------|-----------------------------------------------------------------------------------------------|--------------------------|------------------------------------------------------------------------------------------|
| 1       | זיהוי קליק על כפתור `#expExcel`.                                                              | `pages/clients.php` (JS) | `$('#expExcel').on('click', function() { window.location.href = 'ajax_excel_clients.php' + window.location.search; });` |
| 2       | בקובץ `ajax_excel_clients.php`, הרכבת תנאי ה-`WHERE` וה-BOM/כותרות.                           | `ajax_excel_clients.php` | `header('Content-disposition: attachment; filename="clients.csv"'); fputcsv($xmlFile, $columns); ...`                    |
| 3       | שליפת השורות המתאימות מ-`crm_clients` וכתיבתן בלולאה כ-CSV.                                    | `ajax_excel_clients.php` | `foreach($temp as $row) { fputcsv(...); }`                                                                                 |
| 4       | הדפדפן מוריד את הקובץ אוטומטית (Content-Disposition).                                         | **דפדפן**               | המשתמש רואה חלונית “שמירה” או “פתיחה” בהתאם להגדרות הדפדפן.                                                                  |

---

#### תרחיש 7: תפריט "הזמנות" (`partials/orders_menu.php`)
**א. ניתוח משתמש הקצה (Front-End Perspective)**
- **תיאור כללי:**  
  קובץ זה מכיל תפריט מעוצב עם קישורים (פעילות, שיריונים, אירועים קרובים/שהיו וכו'). כאשר משתמש לוחץ על אחד מהם, הוא נשלח לעמוד `?page=orders&...`.

| מספר צעד | פעולה מצד המשתמש                   | תוצאה מצופה                                       |
|----------|------------------------------------|---------------------------------------------------|
| 1        | לחיצה על אחד הפריטים בתפריט        | מעבר לעמוד orders המתאים (למשל `?page=orders&otype=order`). |

**ב. ניתוח המימוש בקוד (Back-End Perspective)**
- **תיאור כללי:**  
  הקובץ יוצר מערך `$subMenu2` עם מערך של נתיבי URL ושמות, ולאחר מכן מציג `<a href="?<?=$sub['url']?>">`. אין כאן אינטראקציה עם בסיס נתונים או AJAX – זהו HTML פשוט.

| מס' צעד | לוגיקה טכנית                                                         | מיקום בקוד                 | מבנה ותוכן הקוד                                                           |
|---------|----------------------------------------------------------------------|----------------------------|----------------------------------------------------------------------------|
| 1       | יצירת `$subMenu2` עם ערכים (“פעילות”, “שיריונים” וכו').             | `partials/orders_menu.php` | `$subMenu2[] = array("url"=>"page=orders&otype=order&orderStatus=active", ...);` |
| 2       | לולאה על `$subMenu2` להדפסת `<a>` עם ה-URL                          | `partials/orders_menu.php` | `<a class="<?=$active?>" href="?<?=$sub["url"]?>"><?=$sub["name"]?></a>`   |
| 3       | המשתמש לוחץ על הקישור, עובר לעמוד `orders`.                         | **Front-End**              | ה-URL מעובד במקום אחר במערכת (שאינו מפורט כאן).                             |

---

## 6. מסמך שימוש (מדריך למשתמש)
1. **צפייה ברשימת לקוחות**
    - היכנס לכתובת `?page=clients`. כברירת מחדל יופיעו כל הלקוחות הרשומים, בטבלה.
    - תוכל לגלול ולבדוק את הפרטים (שם, טלפון, כתובת, תאריך הוספה ועוד).

2. **חיפוש וסינון**
    - לחץ על הכותרת “חפש לקוח” לפתיחת טופס הסינון.
    - מלא את השדות הנדרשים (לדוגמה, טווח תאריכים, מקור, יום/חודש/שנת לידה, או חיפוש חופשי).
    - לחץ על “חפש” – הטבלה תציג רק את הלקוחות שעומדים בתנאים שהגדרת.

3. **בחירה אוטומטית (Auto-Complete)**
    - בשדות מסוימים (כגון טלפון או שם בפופ-אפ שליחת SMS), הקלד לפחות 3 תווים.
    - תופיע רשימת השלמה; לחץ על פריט מהרשימה, והשדה יתעדכן אוטומטית.

4. **שליחת SMS**
    - לחץ על הכפתור “שליחת SMS” (נמצא בעמוד הלקוחות).
    - בפופ-אפ, הזן טלפון והקלד את ההודעה (עד 80 תווים).
    - לחץ על “שליחה” לקבלת משוב מיידי אם ההודעה נשלחה בהצלחה.

5. **מחיקת לקוח**
    - בשורת הלקוח בטבלה, לחץ על האייקון “X”.
    - אשר את המחיקה בחלונית הקופצת (OK/Cancel). אם תאשר, הרשומה תימחק במיידי מהמערכת.

6. **ייצוא לאקסל**
    - לחץ על כפתור “ייצוא לאקסל” בעמוד `clients.php`.
    - תתבצע הורדה של קובץ CSV, אותו תוכל לפתוח באפליקציית גליון נתונים (Excel, Google Sheets וכדומה).

7. **שימוש בתפריט ההזמנות**
    - בקובץ `partials/orders_menu.php` יש תפריט הכולל קישורים למגוון דפי Orders. במידה והוא מוטמע באתר, תוכל לנווט בו כדי לעבור לעמוד “הזמנות פעילות”, “שיריונים”, “אחרונות” ועוד.

---

## 7. סיכום
בקבצים הללו מרוכזת מערכת לניהול לקוחות:
- **pages/clients.php** אחראי על תצוגה ויזואלית, סינון, חיפוש, מחיקה ושליחת SMS.
- **ajax_client.php** מטפל בפעולות AJAX של חיפוש לקוחות (auto-complete) ומחיקה.
- **ajax_spaSMS.php** מטפל בשליחת הודעות SMS ושמירתן.
- **ajax_excel_clients.php** מייצר קובץ CSV לייצוא נתוני הלקוחות.
- **partials/orders_menu.php** מספק תפריט לקישורים הקשורים לעמודי הזמנות.

כל תרחישי השימוש (Use Flow) מכסים את צורכי המשתמש לביצוע פעולות שוטפות של ניהול לקוחות ומעבר בין עמודים רלוונטיים. כל הפעולות מגובות בבדיקות הרשאות ובתנאי חיפוש גמישים, והתהליך כולו מתנהל באופן המשלב נוחות משימוש בצד ה-Front-End עם גמישות ויעילות בצד ה-Back-End.

