{
  "pageTitle": "4. פירוט עסקאות (yaadTrans)",
  "sections": [
    {
      "title": "הקדמה",
      "content": "הקובץ yaadTrans.php הוא העמוד הראשי להצגת היסטוריית עסקאות (Transaction History) במערכת, כולל תשלומים עבור הזמנות (orders), מנויים (subscriptions) וגיפט קארד (gift/voucher). בעמוד ניתן לסנן תוצאות לפי תאריך, סטטוס, אמצעי תשלום וחיפוש חופשי, לצפות בפירוט העסקאות, להפיק חשבוניות / חשבוניות זיכוי וכן לבצע ביטולים וזיכויים בכפוף לתנאי הסליקה."
    },
    {
      "title": "הקבצים הרלוונטיים שנבדקו לצורך yaadTrans",
      "content": "<ul>\n<li><code>pages/yaadTrans.php</code> – הקובץ הראשי של הדף, סרוק במלואו.</li>\n<li><code>page4.json</code> – גרסת התיעוד הקודמת, עודכנה כעת.</li>\n<li><code>partials/setReportRange.php</code> – מגדיר טווחי תאריכים ברירת מחדל ושומר העדפות משתמש (היום, השבוע, החודש).</li>\n<li><code>ajax_pop_gift.php</code> – מציג פופ-אפ עם פרטי גיפט-קארד, כולל מימושים/ביטול מימוש, יתרה ועמלות.</li>\n<li><code>download_invoice_gc.php</code> – להורדת חשבונית/ח.זיכוי עבור גיפט קארד.</li>\n<li><code>download_invoice_sub.php</code> – להורדת חשבונית/ח.זיכוי עבור מנויים.</li>\n</ul>"
    },
    {
      "title": "קבצים נוספים (נמצאו בהפניות בקוד אך טרם סופקו במלואם)",
      "content": "<ul>\n<li><code>udb</code> – מחלקה או קובץ המנהל שאילתות DB כמו <code>udb::escape_string()</code>, <code>udb::single_list()</code>.</li>\n<li>מחלקות כמו <code>UserUtilsNew</code>, <code>UserPager</code>, <code>YaadPay</code>, <code>Terminal</code>, <code>Transaction</code>, <code>CardComGeneral</code> – לא סופקו במלואן.</li>\n<li>קבצי Auth וקבצים חיצוניים שההנחיות מורות להשמיט.</li>\n</ul>"
    },
    {
      "title": "תרחישים כוללים בעמוד yaadTrans",
      "subSections": [
        {
          "title": "תרחיש 1: צפייה בכלל העסקאות",
          "content": "משתמש נכנס לעמוד ללא סינון נוסף. הקוד שולף רשומות מ-orderPayments, subscriptionPayments, gift_purchase_payments ומציג בטבלה אחודה. כברירת מחדל, התאריכים מוגדרים ע\"י setReportRange.php (החודש הנוכחי)."
        },
        {
          "title": "תרחיש 2: סינון עסקאות",
          "content": "משתמש בוחר טווח תאריכים, אמצעי תשלום, סטטוס, חיפוש חופשי וכו'. הקוד בונה שאילתות מסוננות (UNION ALL) ומציג רק את העסקאות העונות על הקריטריונים."
        },
        {
          "title": "תרחיש 3: הצגת סיכומי הכנסות והפחתת זיכויים",
          "content": "בראש הדף יש טבלה המסכמת סכומי תשלומים לכל אמצעי התשלום. אם קיימים זיכויים (Refund), הם מופחתים ומתוארים בממשק."
        },
        {
          "title": "תרחיש 4: בחירת טווח תאריכים (setReportRange.php)",
          "content": "ניתן לבחור באחד מכפתורי 'היום', 'השבוע', 'החודש', או להזין תאריכים ידנית. ערכי ברירת המחדל נשמרים ב-SESSION ומתבצע ריענון אוטומטי לאחר הבחירה."
        },
        {
          "title": "תרחיש 5: ביטול או זיכוי עסקה",
          "content": "לחיצה על אייקון 'ביטול' או 'זיכוי' (אם זמינה) תפעיל תהליך מול ספק הסליקה. לאחר השלמת הביטול/זיכוי, העמוד מציג סטטוס 'בוטל' או 'בוצע זיכוי' וייתכן שהונפקה חשבונית זיכוי."
        },
        {
          "title": "תרחיש 6: הפקת חשבונית או חשבונית זיכוי",
          "content": "לחיצה על אייקון 'חשבונית' מפנה לאחד מקבצי download_invoice_*.php בהתאמה (או לכתובת ב-YaadPay). כך מתקבלת חשבונית/ח.ביטול לצפייה או להורדה כ-PDF, אם באתר מוגדר masof_invoice."
        },
        {
          "title": "תרחיש 7: צפייה בגיפט-קארד (ajax_pop_gift.php)",
          "content": "במקרה של עסקת Gift/Voucher, נפתח פופ-אפ המציג פרטי השובר, סכום מקורי, יתרה, ברכה, מימושים שבוצעו ועמלותיהם. ניתן לבטל מימושים שהוגדרו 'cancellable'."
        },
        {
          "title": "תרחיש 8: מימוש חלקי/מלא וזיכוי בגיפט-קארד",
          "content": "בפופ-אפ הגיפט-קארד, משתמש יכול לבחור 'מימוש חלקי' לסכום חלקי מהיתרה, 'מימוש מלא' אם לא נוצל השובר כלל, או לבצע זיכוי (Refund) מלא אם אין מימושים עד כה."
        },
        {
          "title": "תרחיש 9: צפייה בפרטי מנוי",
          "content": "בעסקת מנוי (lineType = 'subs'), לחיצה פותחת חלון (openSubscription). כך מציגים את פרטי המנוי והיסטוריית התשלומים (לא סופק קובץ מלא)."
        }
      ]
    },
    {
      "title": "קבצים שנבדקו לצורך yaadTrans",
      "content": "<ul>\n<li><code>pages/yaadTrans.php</code> – (הקובץ הראשי).</li>\n<li><code>page4.json</code> – (תיעוד מקורי, עודכן כעת).</li>\n<li><code>partials/setReportRange.php</code>, <code>ajax_pop_gift.php</code>, <code>download_invoice_gc.php</code>, <code>download_invoice_sub.php</code> – נבדקו במלואם והמידע שולב בתיעוד.</li>\n</ul>"
    },
    {
      "title": "קבצים חסרים להשלמת חלק מהתרחישים",
      "content": "<ul>\n<li><code>udb</code> – ספריית DB.</li>\n<li><code>UserUtilsNew</code>, <code>UserPager</code>, <code>YaadPay</code>, <code>Terminal</code> ועוד – לא סופקו במלואם.</li>\n</ul>"
    },
    {
      "title": "סיכום (yaadTrans)",
      "content": "<ul>\n<li><strong>yaadTrans.php</strong> מציג היסטוריית עסקאות עבור הזמנות, מנויים וגיפט קארד, עם יכולות חיפוש וסינון מתקדמות.</li>\n<li>מגדיר טווח תאריכים בעזרת <code>setReportRange.php</code>, ומאפשר להפיק חשבוניות, לבצע ביטולים/זיכויים, ולצפות בפרטי גיפט קארד כולל מימוש חלקי/מלא.</li>\n<li>לקבלת מסמך שלם במאה אחוז, יש לעיין בשאר הקבצים/מחלקות המוזכרות כאן, שלא נבדקו במלואן.</li>\n</ul>"
    }
  ]
}
