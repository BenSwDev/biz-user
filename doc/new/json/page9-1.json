{
  "pageTitle": "9.1 הגדרות ספא (treatments)",
  "sections": [
    {
      "title": "הקדמה",
      "content": "הקובץ treatments.php הוא חלק ממערכת ניהול הספא. מטרתו לאפשר: 1. הגדרה וניהול של טיפולים ומחיריהם (בטבלת treatmentsPricesSites) עבור אתר (siteID) מסוים. 2. הצגה ועריכת זמני טיפול שונים (30, 45, 60 דקות וכו'). 3. עדכון \"זמן ניקיון\" (waitingTime) בטבלת sites. בנוסף, מתבצעת קריאה ל-SpaPlusRelay (אם זמין) לצורך שליחת עדכוני מחירים חיצוניים."
    },
    {
      "title": "הקבצים הרלוונטיים שנבדקו",
      "content": "<ul><li><code>treatments.php</code> (הקובץ הראשי שהוצג במלואו בשיחה)</li></ul>"
    },
    {
      "title": "קבצים נוספים (לפי הקוד)",
      "content": "<ul>\n<li>טבלאות DB רלוונטיות:\n<ul>\n<li><code>sitesTratments</code> – טבלה השומרת ערכי JSON של טיפולים (treatments) וזמני טיפול (times) עבור כל אתר (bizSiteID).</li>\n<li><code>treatmentsPricesSites</code> – הטבלה בה נשמרים המחירים (price1, price2, price3) לפי מזהה טיפול (treatmentID) ומשך טיפול (duratuion).</li>\n<li><code>sites</code> – טבלה בה נשמר בין היתר השדה waitingTime (\"זמן ניקיון\").</li>\n<li><code>treatments</code> – טבלת הטיפולים (name, treatmentID, וכו').</li>\n</ul>\n</li>\n<li><code>udb::</code> – ספריית DB לשאילתות (insert, update, query).</li>\n<li><code>SpaPlusRelay</code> – מחלקה חיצונית (לא סופקה במלואה) ובה המתודה <code>sendPrices()</code>.</li>\n<li><code>TfusaBaseUser</code> / <code>TfusaUser</code> – מחלקות משתמש והרשאות (חסרות במלואן).</li>\n</ul>"
    },
    {
      "title": "תרחישים כוללים בעמוד treatments",
      "subSections": [
        {
          "title": "תרחיש 1: טעינת העמוד להצגת טבלת טיפולים",
          "content": "<table>\n<thead>\n<tr>\n<th>שלב</th>\n<th>צד המשתמש</th>\n<th>צד הקוד</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.1</td>\n<td>משתמש נכנס לכתובת: <code>?page=treatments</code>. רואה טבלה עם שמות הטיפולים, משכי הזמן הזמינים ומחירים ליחיד/זוג/קבוצה.</td>\n<td>1. הקוד קורא את <code>treatmentsPricesSites</code> (למשל <code>SELECT DISTINCT duratuion FROM treatmentsPricesSites WHERE siteID=...</code>) ומאתר את משכי הטיפול.&lt;br&gt;2. הקוד שולף את המחירים הקיימים (price1, price2, price3) עבור כל טיפול ומשך.&lt;br&gt;3. הקוד שולף את <code>waitingTime</code> מהטבלה <code>sites</code> ומציג למשתמש כפתורי רדיו לבחירת זמן ניקיון.&lt;br&gt;4. הקוד שולף גם רשימת טיפולים מטבלת <code>treatments</code> ומציג אותם בטבלה.</td>\n</tr>\n</tbody>\n</table>"
        },
        {
          "title": "תרחיש 2: עדכון מחירי טיפול ושמירה",
          "content": "<table>\n<thead>\n<tr>\n<th>שלב</th>\n<th>צד המשתמש</th>\n<th>צד הקוד</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2.1</td>\n<td>משתמש מעדכן מחירים חדשים עבור משך טיפול מסוים (למשל 60 דקות) ולוחץ “שמור”.</td>\n<td>1. נשלחת בקשת <code>POST</code> עם <code>tprice[treatmentID][duratuion]</code>, <code>tprice2</code>, <code>tprice3</code> ועוד.&lt;br&gt;2. הקוד מוחק רשומות ישנות ב־<code>treatmentsPricesSites</code> עבור ה־siteID הספציפי, ומוסיף את החדשות באמצעות <code>udb::insert()</code>.&lt;br&gt;3. אם <code>SpaPlusRelay</code> מופעל, הוא קורא ל־<code>sendPrices()</code> לשליחת עדכוני מחירים חיצוניים.&lt;br&gt;4. מפנה מחדש את המשתמש חזרה ל־<code>?page=treatments</code>.</td>\n</tr>\n</tbody>\n</table>"
        },
        {
          "title": "תרחיש 3: עדכון זמן ניקיון (waitingTime)",
          "content": "<table>\n<thead>\n<tr>\n<th>שלב</th>\n<th>צד המשתמש</th>\n<th>צד הקוד</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3.1</td>\n<td>משתמש בוחר אחד מכפתורי הרדיו בין 0 ל־30 דקות ולוחץ “שמור”.</td>\n<td>1. מתקבל ערך <code>timeout</code> בפוסט.&lt;br&gt;2. הקוד מעדכן את השדה <code>waitingTime</code> בטבלת <code>sites</code>.&lt;br&gt;3. ממשיך עם שמירת הטיפולים אם הוזנו מחירים.&lt;br&gt;4. מפנה מחדש ל־<code>?page=treatments</code>.</td>\n</tr>\n</tbody>\n</table>"
        },
        {
          "title": "תרחיש 4: תרחישי גישה והרשאות",
          "content": "<p>משתמש שאינו בעל הרשאות (לא <code>ACCESS_SUPER</code> ולא <code>userType=0</code>) רואה את השדות במצב <code>readonly</code> ללא אפשרות לשמור. במידה והמשתמש אינו משויך לאתר, המערכת מגדירה עבורו אוטומטית אתר פעיל. קיימת גם לוגיקה (מגיבה לבחור אתר אחר) שמופיעה בהערות בקוד.</p>"
        }
      ]
    },
    {
      "title": "קבצים שנבדקו לצורך treatments",
      "content": "<ul>\n<li><code>treatments.php</code> – קובץ עיקרי שהוצג במלואו.</li>\n</ul>"
    },
    {
      "title": "קבצים חסרים להשלמת חלק מהתרחישים",
      "content": "<ul>\n<li><code>SpaPlusRelay</code> – לא סופק במלואו, ידוע שקיימת המתודה <code>sendPrices()</code>.</li>\n<li>מידע מלא על הטבלאות (<code>treatments</code>, <code>treatmentsPricesSites</code>, <code>sites</code>, <code>sitesTratments</code>) לא סופק.</li>\n<li>מחלקות משתמש והרשאות (למשל <code>TfusaBaseUser</code>, <code>TfusaUser</code>) לא סופקו במלואן.</li>\n</ul>"
    },
    {
      "title": "סיכום (treatments)",
      "content": "<ul>\n<li><strong>treatments.php</strong> מאפשר ניהול טיפולים ומחיריהם, הגדרת זמן ניקיון (<code>waitingTime</code>) ועריכת המחירים עבור משכי טיפול שונים (יחיד/זוג/קבוצה).</li>\n<li>השינויים נשמרים בטבלת <code>treatmentsPricesSites</code> (ומעודכנים ב־<code>sites</code> עבור זמן ניקיון), והם משויכים ל־<code>siteID</code>.</li>\n<li>אם <code>SpaPlusRelay</code> מופעל, הוא שולח את העדכון החוצה דרך <code>sendPrices()</code>.</li>\n<li>פעולות אלה זמינות רק למשתמש בעל הרשאות מתאימות.</li>\n</ul>"
    }
  ]
}
